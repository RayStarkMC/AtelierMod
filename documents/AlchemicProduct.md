# 錬金術製品について

## 錬金術製品とは
錬金術によって作られる製品 以下の性能を持つ。
* 品質
* 効果
* 潜在能力

## 性能の指標

### 効果
[効果について](Effect.md)
ダメージを与える、地形に影響を与える等といった、そのアイテムの具体的な効果。効果そのものに強弱があり、それらはツールチップ上では抽象的に表現される。  
製品毎に何の効果を持つ事が出来るかがあらかじめ決められており、調合時の属性値によって同じアイテムでもどの効果が付与されるかが変わる。

### 潜在能力
[潜在能力について](PotentialAbitily.md)
前述の効果に対して補助的に作用する効果。効果そのものに強弱があり、それらはツールチップ上では抽象的に表現される。  
製品毎に潜伏した状態で潜在能力を持っており、アトリエシステムにより解禁することが出来る。  
材料に用いた素材が顕在化した潜在能力を持っていた場合、それを製品に引き継ぐことが出来る。  
調合時に製品に対して潜在能力を付与する方法は以下の通り。
* 完成品が持つ潜在能力を開放する。
* 調合に用いた素材が持っている潜在能力を引き継ぐ。  

潜在能力毎に影響を与えることが出来る効果の種類が決められており、不適当な効果に対しては何も影響を与えない。

### 品質
上述の効果に対して、その性能の基準となる値。ツールチップ上では正の整数で表現され、大きければ大きいほど効果が強力になる。  
材料に用いた素材と調合時に用いたスキルによって製品の品質が決定される。  
効果によっては品質の影響を受けないものがある。

## 仕様

### 能力の保存について
そのアイテムの持つ効果、潜在能力、品質はNBTに保存される。    
ex.  
[効果]  
石を掘る  
きれいに掘る  
[潜在能力]  
採掘速度が早くなる  

### 能力の適用について
効果に対して品質の補正が掛かりアイテムの主な性能を決定する。  
主な動作が決定した後、更に潜在能力の補正を受けて全ての性能が決まる。

### 能力の表記について
そのアイテムがもつ効果、潜在能力、品質はShiftダウンでツールチップ上に表示される。


## 実装

### 能力の保存
アイテムがクラフトされた時(及びクリエタブに登録されるとき)にNBTTagCompoundを付与。  
付与されたTagに対してキー"modAtelier"でTagCompoundを付与。  
modAtelierに対して効果、潜在能力をNBTTagListで保存。  

NBT構造 NBTBase("キー")
* NBTTagCompound
    * NBTTagCompound("ModAtelier")
        * NBTTagInteger("Quality")
        * NBTTagList("Effect") : String
            * Effect1
            * Effect2
            * ...
        * NBTTagList("PotentialAbility") : String
            * Ability1
            * Ability2
            * ...

### 能力の適用
アイテムやブロックの性能の内効果に対応するメソッドをOverrideする。  
ex.
* 掘削速度：getDigSpeed()
* 掘削レベル：getHarvestLevel()

フローチャート
1. アイテムのNBTTagCompoundから品質、効果、潜在能力それぞれを取り出す。
2. 効果と品質からアイテムの主な性能を決定する。
3. 潜在能力の内効果に提供を与えられるものがあれば適応する。

